<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FitApp.WorkoutListPage"
             xmlns:local="clr-namespace:FitApp.ViewModels"
             xmlns:models="clr-namespace:FitApp.Models"
             Title="Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="14">

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <Label Text="ÐœÐ¾Ð¸ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸"
                   FontSize="24"
                   FontAttributes="Bold"/>

            <Label Text="Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ, Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ðº."
                   FontSize="13"
                   TextColor="Gray"
                   Margin="0,-8,0,0"/>

            <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² -->
            <Border Padding="14"
                    BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1E3A5F}"
                    StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="12">
                    <Label Text="Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#0D47A1, Dark=#E3F2FD}"/>

                    <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ -->
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                        <DatePicker Grid.Column="0"
                                    Date="{Binding FilterDate, Mode=TwoWay}"
                                    Format="d"
                                    MinimumDate="1/1/2020"
                                    MaximumDate="1/1/2030"/>

                        <Button Grid.Column="1"
                                Text="ðŸ”"
                                Command="{Binding FilterByDateCommand}"
                                BackgroundColor="#2196F3"
                                TextColor="White"
                                CornerRadius="10"
                                WidthRequest="52"
                                HeightRequest="44"/>

                        <Button Grid.Column="2"
                                Text="Ð’ÑÐµ"
                                Command="{Binding ShowAllWorkoutsCommand}"
                                BackgroundColor="#4CAF50"
                                TextColor="White"
                                CornerRadius="10"
                                WidthRequest="64"
                                HeightRequest="44"/>
                    </Grid>

                    <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð³Ñ€ÑƒÐ¿Ð¿Ðµ Ð¼Ñ‹ÑˆÑ† -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Picker Grid.Column="0"
                                Title="Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð¼Ñ‹ÑˆÑ†"
                                ItemsSource="{Binding AllMuscleGroups}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedFilterMuscleGroup, Mode=TwoWay}" />

                        <Button Grid.Column="1"
                                Text="Ð¤Ð¸Ð»ÑŒÑ‚Ñ€"
                                Command="{Binding FilterByMuscleGroupCommand}"
                                BackgroundColor="#673AB7"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="44"/>
                    </Grid>

                    <Button Text="Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹"
                            Command="{Binding ShowAllWorkoutsCommand}"
                            BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#263238}"
                            TextColor="{AppThemeBinding Light=#1E88E5, Dark=#BBDEFB}"
                            CornerRadius="10"
                            HeightRequest="44"/>
                </VerticalStackLayout>
            </Border>

            <!-- ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ -->
            <Border Padding="14"
                    StrokeThickness="0"
                    BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2D2D30}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="10">
                    <Label Text="âž• ÐÐ¾Ð²Ð°Ñ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Entry Placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸"
                           Text="{Binding WorkoutName, Mode=TwoWay}"
                           ClearButtonVisibility="WhileEditing"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Ð”Ð°Ñ‚Ð°" FontSize="12" TextColor="Gray"/>
                            <DatePicker Date="{Binding SelectedDate, Mode=TwoWay}" Format="d"
                                        MinimumDate="1/1/2010"
                                        MaximumDate="1/1/2030"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Ð’Ñ€ÐµÐ¼Ñ" FontSize="12" TextColor="Gray"/>
                            <TimePicker Time="{Binding SelectedTime, Mode=TwoWay}"/>
                        </VerticalStackLayout>
                    </Grid>

                    <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÑƒ"
                            Command="{Binding AddWorkoutCommand}"
                            BackgroundColor="#FF9800"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="50"/>
                </VerticalStackLayout>
            </Border>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ðº -->
            <Label Text="Ð¡Ð¿Ð¸ÑÐ¾Ðº"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="0,6,0,0"/>

            <CollectionView ItemsSource="{Binding FilteredWorkouts}"
                            SelectionMode="Single"
                            SelectionChanged="OnWorkoutSelected">

                <CollectionView.EmptyView>
                    <Border Padding="20"
                            StrokeThickness="0"
                            BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="14"/>
                        </Border.StrokeShape>

                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ðº Ð½ÐµÑ‚"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"/>
                            <Label Text="ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÑƒ."
                                   FontSize="13"
                                   TextColor="Gray"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Workout">
                        <SwipeView>
                            <!-- ÑÐ²Ð°Ð¹Ð¿ Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ -->
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                               BackgroundColor="#E53935"
                                               Command="{Binding Source={RelativeSource AncestorType={x:Type local:WorkoutViewModel}}, Path=DeleteWorkoutCommand}"
                                               CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ -->
                            <Border Padding="14"
                                    Margin="0,0,0,10"
                                    StrokeThickness="1"
                                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#3A3A3A}"
                                    BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="14"/>
                                </Border.StrokeShape>

                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="10">
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Name}"
                                           FontSize="16"
                                           FontAttributes="Bold"/>

                                    <Label Grid.Row="1" Grid.Column="0"
                                           Text="{Binding StartTime, StringFormat='{0:dd.MM.yyyy HH:mm}'}"
                                           FontSize="13"
                                           TextColor="Gray"/>

                                    <Label Grid.RowSpan="2" Grid.Column="1"
                                           Text="â€º"
                                           FontSize="26"
                                           TextColor="Gray"
                                           VerticalOptions="Center"/>
                                </Grid>
                            </Border>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
