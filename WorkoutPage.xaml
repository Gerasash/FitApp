<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FitApp.WorkoutPage"
             xmlns:local="clr-namespace:FitApp.ViewModels"
             xmlns:models="clr-namespace:FitApp.Models"
             Title="{Binding WorkoutName}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="14">

            <!-- Ð¨Ð°Ð¿ÐºÐ° Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ -->
            <Border Padding="14"
        StrokeThickness="0"
        BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2D2D30}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="10">
                    <Label Text="Ð“Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¼Ñ‹ÑˆÑ†"
               FontAttributes="Bold"
               FontSize="16"/>

                    <CollectionView ItemsSource="{Binding AllMuscleGroups}"
                    SelectionMode="Multiple"
                    SelectedItems="{Binding SelectedMuscleGroups}"
                    ItemsLayout="HorizontalList"
                    HeightRequest="54">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="12,8"
                        Margin="0,0,10,0"
                        StrokeThickness="1"
                        Stroke="{AppThemeBinding Light=#BDBDBD, Dark=#5A5A5A}">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="999"/>
                                    </Border.StrokeShape>

                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup Name="CommonStates">
                                            <VisualState Name="Normal">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor"
                                            Value="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}" />
                                                </VisualState.Setters>
                                            </VisualState>
                                            <VisualState Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor"
                                            Value="{AppThemeBinding Light=#C8E6C9, Dark=#1B5E20}" />
                                                    <Setter Property="Stroke"
                                            Value="{AppThemeBinding Light=#2E7D32, Dark=#66BB6A}" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>

                                    <Label Text="{Binding Name}"
                            FontAttributes="Bold"
                            FontSize="13"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Label Text="Ð¢Ð°Ð¿ Ð¿Ð¾ Ñ‚ÐµÐ³Ð°Ð¼ â€” Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ/ÑÐ½ÑÑ‚ÑŒ."
               FontSize="12"
               TextColor="Gray"/>
                </VerticalStackLayout>
            </Border>

            <!-- Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <Label Grid.Column="0"
                       Text="Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ"
                       FontSize="18"
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>

                <Button Grid.Column="1"
                        Text="âž• Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ"
                        HeightRequest="44"
                        Padding="14,0"
                        CornerRadius="12"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        Clicked="ToModalPage"/>
            </Grid>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ð¹ -->
            <CollectionView ItemsSource="{Binding WorkoutExercises}"
                            SelectionMode="None">

                <CollectionView.EmptyView>
                    <Border Padding="18"
                            StrokeThickness="0"
                            BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2D2D30}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="14"/>
                        </Border.StrokeShape>

                        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                            <Label Text="ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ð¹"
                                   FontAttributes="Bold"
                                   FontSize="16"/>
                            <Label Text="ÐÐ°Ð¶Ð¼Ð¸ â€œâž• Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµâ€, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿ÐµÑ€Ð²Ð¾Ðµ."
                                   TextColor="Gray"
                                   FontSize="13"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:WorkoutExercise">
                        <Border Padding="14"
                                Margin="0,0,0,10"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#3A3A3A}"
                                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16"/>
                            </Border.StrokeShape>

                            <VerticalStackLayout Spacing="10">

                                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ -->
                                <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="10">
                                    <Border Grid.Column="0"
                                        WidthRequest="34"
                                        HeightRequest="34"
                                        StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light=#F3E5F5, Dark=#3A2A4A}">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <Label Text="{Binding OrderIndex}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=#6A1B9A, Dark=#E1BEE7}"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" Spacing="2">
                                        <Label Text="{Binding ExerciseName}"
                                        FontSize="16"
                                        FontAttributes="Bold"/>
                                        <Label Text="ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ñ‹:"
                                           FontSize="12"
                                           TextColor="Gray"/>
                                    </VerticalStackLayout>

                                    <!-- âž• ÐŸÐ¾Ð´Ñ…Ð¾Ð´ -->
                                    <Button Grid.Column="2"
                                            Text="âž• ÐŸÐ¾Ð´Ñ…Ð¾Ð´"
                                            FontSize="13"
                                            HeightRequest="36"
                                            Padding="12,0"
                                            CornerRadius="12"
                                            BackgroundColor="#FF9800"
                                            TextColor="White"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type local:WorkoutViewModel}}, Path=AddSetCommand}"
                                            CommandParameter="{Binding .}"/>

                                    <!-- ðŸ—‘ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ (Ð´Ð»Ñ ÐŸÐš Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾) -->
                                    <Button Grid.Column="3"
                                        Text="ðŸ—‘"
                                        FontSize="16"
                                        HeightRequest="36"
                                        WidthRequest="44"
                                        CornerRadius="12"
                                        BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3A1E1E}"
                                        TextColor="#E53935"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type local:WorkoutViewModel}}, Path=DeleteWorkoutExerciseCommand}"
                                        CommandParameter="{Binding .}"/>
                                </Grid>

                                <!-- ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ñ‹ -->
                                <CollectionView ItemsSource="{Binding Sets}" SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:ExerciseSet">
                                            <Border Padding="10"
                                                Margin="0,0,0,8"
                                            StrokeThickness="0"
                                        BackgroundColor="{AppThemeBinding Light=#F7F7F7, Dark=#2A2A2A}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="12"/>
                                                </Border.StrokeShape>

                                                <Grid ColumnDefinitions="Auto,*,*,Auto" ColumnSpacing="10">
                                                    <Label Grid.Column="0"
                                                           Text="{Binding SetNumber, StringFormat='#{0}'}"
                                                           FontAttributes="Bold"/>

                                                    <Label Grid.Column="1"
                                                         Text="{Binding Weight, StringFormat='{0:F1} ÐºÐ³'}"/>

                                                    <Label Grid.Column="2"
                                                         Text="{Binding Reps, StringFormat='{0} Ð¿Ð¾Ð²Ñ‚'}"/>

                                                    <!-- âœ– ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ -->
                                                    <Button Grid.Column="3"
                    Text="âœ–"
                    FontSize="14"
                    HeightRequest="32"
                    WidthRequest="40"
                    CornerRadius="10"
                    BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3A1E1E}"
                    TextColor="#E53935"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:WorkoutViewModel}}, Path=DeleteSetCommand}"
                    CommandParameter="{Binding .}"/>
                                                </Grid>
                                            </Border>

                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>


                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,10,0,20">
                <Button Grid.Column="0"
            Text="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
            Command="{Binding UpdateWorkoutCommand}"
            BackgroundColor="#2196F3"
            TextColor="White"
            CornerRadius="14"
            HeightRequest="52"/>

                <Button Grid.Column="1"
            Text="ÐÐ°Ð·Ð°Ð´"
            Clicked="OnBackButtonClicked"
            BackgroundColor="{AppThemeBinding Light=#EEEEEE, Dark=#2D2D30}"
            TextColor="{AppThemeBinding Light=Black, Dark=White}"
            CornerRadius="14"
            HeightRequest="52"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
